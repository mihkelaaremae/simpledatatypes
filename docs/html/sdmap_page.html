<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simple dynamic datatypes: SDMAP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Simple dynamic datatypes
   </div>
   <div id="projectbrief">Simple dynamic datatypes for C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SDMAP </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sdmap_usage">Usage</a><ul><li class="level2"><a href="#sdmap_intro">Introdunction</a></li>
<li class="level2"><a href="#sdmap_create">Creation/Deletion</a></li>
<li class="level2"><a href="#sdmap_querying">Querying</a></li>
<li class="level2"><a href="#sdmap_test">Testing values</a></li>
<li class="level2"><a href="#sdmap_getset">Getting/setting/erasing values</a></li>
<li class="level2"><a href="#sdmap_getsetp">Getting/Setting pointers</a></li>
<li class="level2"><a href="#sdmap_advanced">Advanced</a></li>
</ul>
</li>
<li class="level1"><a href="#sdmap_usermacros">User macros</a></li>
<li class="level1"><a href="#sdmap_pitfalls">Pitfalls</a><ul><li class="level2"><a href="#sdmap_stack_type_maps">Stack-type maps</a></li>
<li class="level2"><a href="#sdmap_pointer_invalid">Pointer invalidation</a></li>
<li class="level2"><a href="#sdmap_amortized">Amortizied complexity</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="el" href="sdmap_8h.html">See the file reference</a></p>
<h1><a class="anchor" id="sdmap_usage"></a>
Usage</h1>
<h2><a class="anchor" id="sdmap_intro"></a>
Introdunction</h2>
<p>SDMAP is an associative map type that maps a single unique key to a single value. There are two types of sdmaps - heap and stack type. These refer to where they are stored in memory. Heap-type maps are put on the heap using the <a class="el" href="sdmap_8h.html#abccb263f6ef93f0b81390a418d3f378e">sdmap_malloc</a>, <a class="el" href="sdmap_8h.html#ab022021ac52ab2e5aa72b84dfe2994e4">sdmap_realloc</a> <a class="el" href="sdmap_8h.html#ab08e085dfdb64d3ee572c01a7b974e92">sdmap_free</a> functions. Stack type maps are automatically put on the stack but only have the lifetime of the scope they are declared in. Stack-types may be variable-sized, the rules/conventions are all the same as with VLA-s. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">float</span>) a; <span class="comment">//Declare a to be a heap-type map that maps ints to floats</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>, 20) b; <span class="comment">//Declare b to be a stack-type map that maps strings to ints and has a maximum capacity of 20 entries.</span></div>
<div class="ttc" id="asdmap_8h_html_a6824b46342ace03c477fc71c66271e31"><div class="ttname"><a href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a></div><div class="ttdeci">#define sdmap(key_type, value_type)</div><div class="ttdoc">Heap-type simple dynamic map type generator.</div><div class="ttdef"><b>Definition:</b> sdmap.h:114</div></div>
<div class="ttc" id="asdmap_8h_html_ae441701f375f9a200aea81c465c2d8da"><div class="ttname"><a href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a></div><div class="ttdeci">#define sdmap_stack(key_type, value_type, element_count)</div><div class="ttdoc">Stack-type simple dynamic map type generator.</div><div class="ttdef"><b>Definition:</b> sdmap.h:138</div></div>
</div><!-- fragment --><h2><a class="anchor" id="sdmap_create"></a>
Creation/Deletion</h2>
<p>Heap-type maps are considered valid empty maps when assigned a NULL pointer. This cannot be done to stack-type maps as they are internally kept as VLA-s. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a;  <span class="comment">//Declare map a</span></div>
<div class="line">a = NULL;           <span class="comment">//Assign a to be an empty map.</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 10) b; <span class="comment">//Declare map b</span></div>
<div class="line">b = NULL;                    <span class="comment">//COMPILER ERROR</span></div>
</div><!-- fragment --><p> Alternatively maps can be initialized with the <a class="el" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a> function. This function has optional parameters to define the desired initial capacity and compare funciton. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a;  <span class="comment">//Declare map a</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) b;  <span class="comment">//Declare map b</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) c;  <span class="comment">//Declare map c</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(a);                           <span class="comment">//Initialize map with default settings.</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(b, custom_int_compare);       <span class="comment">//Initialize map with a custom integer compare function compare function.</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(c, custom_int_compare, 7);    <span class="comment">//Initialize map with a custom integer compare function and enough capacity for 7 elements.</span></div>
<div class="ttc" id="asdmap_8h_html_a5cef0a813ffbfeca143b1252b993b074"><div class="ttname"><a href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a></div><div class="ttdeci">#define sdmap_new(...)</div><div class="ttdoc">Construct a new map.</div><div class="ttdef"><b>Definition:</b> sdmap.h:260</div></div>
</div><!-- fragment --><p> This is the only way to initialize stack-type maps as they cannot be assigned NULL. The stack-type maps also omit the last parameter of <a class="el" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 3) a;  <span class="comment">//Declare map a</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 4) b;  <span class="comment">//Declare map b</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 5) c;  <span class="comment">//Declare map c</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(a);       <span class="comment">//Initialize map with default settings.</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(b, custom_int_compare);    <span class="comment">//Initialize map with a custom compare function.</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(c, custom_int_compare, 7);    <span class="comment">//COMPILER ERROR</span></div>
</div><!-- fragment --><p> <br  />
Heap-type maps should be cleaned up with <a class="el" href="sdmap_8h.html#ac8713226f2dcc338237aedf3277d3724">sdmap_delete</a>, NOT TO BE CONFUSED WITH <a class="el" href="sdmap_8h.html#ab08e085dfdb64d3ee572c01a7b974e92">sdmap_free</a>. Stack-type maps can also be called with this function but it is a no-op. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 100) b;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(a);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(b);</div>
<div class="line"><span class="comment">//Do some stuff with the maps</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ac8713226f2dcc338237aedf3277d3724">sdmap_delete</a>(a);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ac8713226f2dcc338237aedf3277d3724">sdmap_delete</a>(b);    <span class="comment">//Not necessary, but decent compilers with access to the underlying function will optimize this away.</span></div>
<div class="ttc" id="asdmap_8h_html_ac8713226f2dcc338237aedf3277d3724"><div class="ttname"><a href="sdmap_8h.html#ac8713226f2dcc338237aedf3277d3724">sdmap_delete</a></div><div class="ttdeci">#define sdmap_delete(map)</div><div class="ttdoc">Free and invalidate map.</div><div class="ttdef"><b>Definition:</b> sdmap.h:700</div></div>
</div><!-- fragment --><p> Lastly, maps can be duplicated using <a class="el" href="sdmap_8h.html#a267d1e897c6a2c25482a804dff0efa4f">sdmap_duplicate</a>. <br  />
Duplication counts as initialization so the destination of duplication should be an uninitialized variable.<br  />
This function will not care about the source/destination being heap/stack-typed, but it will trip an assert is the user attempts to duplicate into a stack-type map that has too little capacity to match the source. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 20) a;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ae441701f375f9a200aea81c465c2d8da">sdmap_stack</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>, 40) b;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a5cef0a813ffbfeca143b1252b993b074">sdmap_new</a>(a);</div>
<div class="line"><span class="comment">//Fill a with values</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a267d1e897c6a2c25482a804dff0efa4f">sdmap_duplicate</a>(b, a);  <span class="comment">//Ok, b has higher capacity than a</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a267d1e897c6a2c25482a804dff0efa4f">sdmap_duplicate</a>(a, b);  <span class="comment">//Ok, b has the same amount of slots taken as a</span></div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ad448ee70d29eafd9f054b2a61379259c">sdmap_set</a>(b, unique_key, 0);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#a267d1e897c6a2c25482a804dff0efa4f">sdmap_duplicate</a>(a, b);  <span class="comment">//ERROR, b has a higher amount of slots taken than the capacity of a</span></div>
<div class="ttc" id="asdmap_8h_html_a267d1e897c6a2c25482a804dff0efa4f"><div class="ttname"><a href="sdmap_8h.html#a267d1e897c6a2c25482a804dff0efa4f">sdmap_duplicate</a></div><div class="ttdeci">#define sdmap_duplicate(map, source)</div><div class="ttdoc">Duplicate an existing map.</div><div class="ttdef"><b>Definition:</b> sdmap.h:274</div></div>
<div class="ttc" id="asdmap_8h_html_ad448ee70d29eafd9f054b2a61379259c"><div class="ttname"><a href="sdmap_8h.html#ad448ee70d29eafd9f054b2a61379259c">sdmap_set</a></div><div class="ttdeci">#define sdmap_set(map, key_expr, value_expr)</div><div class="ttdoc">Set a value to a key. If the key already exists in the map, then it is overwritten.</div><div class="ttdef"><b>Definition:</b> sdmap.h:353</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="sdmap_querying"></a>
Querying</h2>
<p>The size of a map can be queried with <a class="el" href="sdmap_8h.html#a61115c6087da074045186992152febee">sdmap_count</a>. This means the amount of entires the map contains.<br  />
The capacity of a map can be queried with <a class="el" href="sdmap_8h.html#adad8071bdddc61416b1d7217a0c96eec">sdmap_capacity</a>. Capacity is the amount of entires that can exist in the map before a resize is triggered for heap-type maps. Trying to exceed the capacity of a stack-type map will trip an assert. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a = NULL;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 0);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 1);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 2);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 3);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 4);</div>
<div class="line">printf(<span class="stringliteral">&quot;%d %d&quot;</span>, (<span class="keywordtype">int</span>)<a class="code hl_define" href="sdmap_8h.html#a61115c6087da074045186992152febee">sdmap_count</a>(a), (<span class="keywordtype">int</span>)<a class="code hl_define" href="sdmap_8h.html#adad8071bdddc61416b1d7217a0c96eec">sdmap_capacity</a>(a));</div>
<div class="ttc" id="asdmap_8h_html_a61115c6087da074045186992152febee"><div class="ttname"><a href="sdmap_8h.html#a61115c6087da074045186992152febee">sdmap_count</a></div><div class="ttdeci">#define sdmap_count(map)</div><div class="ttdoc">Retrieve the amount of elements in the map.</div><div class="ttdef"><b>Definition:</b> sdmap.h:167</div></div>
<div class="ttc" id="asdmap_8h_html_abae88efd1bcf9c22198e7845ab6928d2"><div class="ttname"><a href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a></div><div class="ttdeci">#define sdmap_get(map, key_expr)</div><div class="ttdoc">Retrieve a value associated with a key, if key doesn't exist then inserts an element.</div><div class="ttdef"><b>Definition:</b> sdmap.h:320</div></div>
<div class="ttc" id="asdmap_8h_html_adad8071bdddc61416b1d7217a0c96eec"><div class="ttname"><a href="sdmap_8h.html#adad8071bdddc61416b1d7217a0c96eec">sdmap_capacity</a></div><div class="ttdeci">#define sdmap_capacity(map)</div><div class="ttdoc">Retrieve the amount of elements the map can store currently.</div><div class="ttdef"><b>Definition:</b> sdmap.h:189</div></div>
</div><!-- fragment --><p> Output of the code with default settings: </p><div class="fragment"><div class="line">5 16</div>
</div><!-- fragment --><h2><a class="anchor" id="sdmap_test"></a>
Testing values</h2>
<p>The user can test for the presence of values with <a class="el" href="sdmap_8h.html#a0b15c32cd209c23b0209b532ae4761b1">sdmap_contains</a>. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">char</span> *, <span class="keywordtype">float</span>) a;</div>
<div class="line"><span class="comment">//Initialize...</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_define" href="sdmap_8h.html#a0b15c32cd209c23b0209b532ae4761b1">sdmap_contains</a>(a, <span class="stringliteral">&quot;property&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%f\n&quot;</span>, <a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, <span class="stringliteral">&quot;property&quot;</span>));</div>
<div class="line">}</div>
<div class="ttc" id="asdmap_8h_html_a0b15c32cd209c23b0209b532ae4761b1"><div class="ttname"><a href="sdmap_8h.html#a0b15c32cd209c23b0209b532ae4761b1">sdmap_contains</a></div><div class="ttdeci">#define sdmap_contains(map, key_expr)</div><div class="ttdoc">Test if a key exists in the map.</div><div class="ttdef"><b>Definition:</b> sdmap.h:213</div></div>
</div><!-- fragment --><p> Alternatively this can be done even more efficiently with <a class="el" href="sdmap_8h.html#ab927e5fc44e3ba18d843e9a27aa5f75e">sdmap_getp</a> </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">char</span> *, <span class="keywordtype">float</span>) a;</div>
<div class="line"><span class="comment">//Initialize...</span></div>
<div class="line"><span class="keywordflow">if</span> (<span class="keywordtype">float</span> *v = <a class="code hl_define" href="sdmap_8h.html#ab927e5fc44e3ba18d843e9a27aa5f75e">sdmap_getp</a>(a, <span class="stringliteral">&quot;property&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%f\n&quot;</span>, *v);</div>
<div class="line">}</div>
<div class="ttc" id="asdmap_8h_html_ab927e5fc44e3ba18d843e9a27aa5f75e"><div class="ttname"><a href="sdmap_8h.html#ab927e5fc44e3ba18d843e9a27aa5f75e">sdmap_getp</a></div><div class="ttdeci">#define sdmap_getp(map, key_expr)</div><div class="ttdoc">Retrieve a pointer to a value associated with a key, if key doesn't exist returns NULL.</div><div class="ttdef"><b>Definition:</b> sdmap.h:372</div></div>
</div><!-- fragment --><p> This code will only have to go through the tree once as opposed to twice in the previous snippet. </p>
<h2><a class="anchor" id="sdmap_getset"></a>
Getting/setting/erasing values</h2>
<p>The <a class="el" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a> function will insert an element if the key cannot be found in the map. It will also return an lvalue for the value of the key. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">float</span>) a = NULL;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 1) = 4.5f; <span class="comment">//We can assign the result of sdmap_get</span></div>
<div class="line"><span class="keywordtype">float</span> *result = &amp;<a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 2); <span class="comment">//And even take its pointer...</span></div>
<div class="line">*result = 5.0f; <span class="comment">//...to assign to it later</span></div>
<div class="line">printf(<span class="stringliteral">&quot;%f %f\n&quot;</span>, <a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 1) <a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 2));</div>
</div><!-- fragment --><p> Output of the code: </p><div class="fragment"><div class="line">4.5 5.0</div>
</div><!-- fragment --><p> The <a class="el" href="sdmap_8h.html#ab927e5fc44e3ba18d843e9a27aa5f75e">sdmap_getp</a> function is NOT EQUIVALENT to taking the address of <a class="el" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a> as the latter will mutate the map but the former won't.<br  />
The <a class="el" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a> will not zero any new values it inserts which runs the risk or reading garbage data if the user is not certain that the key exists.<br  />
<br  />
Values can also be assigned with <a class="el" href="sdmap_8h.html#ad448ee70d29eafd9f054b2a61379259c">sdmap_set</a>. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">float</span>) a = NULL;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ad448ee70d29eafd9f054b2a61379259c">sdmap_set</a>(a, 4, 8.0f);</div>
</div><!-- fragment --><p> This is equivalent to (and actually implemented as) <code><a class="el" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2" title="Retrieve a value associated with a key, if key doesn&#39;t exist then inserts an element.">sdmap_get(map, key)</a> = value;</code><br  />
<br  />
Values can be erased with the <a class="el" href="sdmap_8h.html#ab9b3b434ef67ee002598f23a70ade531">sdmap_erase</a> function. Any key that's erased but not present in the map will result in a no-op. </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a = NULL;</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 0);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 1);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 2);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 3);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, 4);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ab9b3b434ef67ee002598f23a70ade531">sdmap_erase</a>(a, 2);</div>
<div class="line"><a class="code hl_define" href="sdmap_8h.html#ab9b3b434ef67ee002598f23a70ade531">sdmap_erase</a>(a, 5);</div>
<div class="line">printf(<span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>)<a class="code hl_define" href="sdmap_8h.html#a61115c6087da074045186992152febee">sdmap_count</a>(a));</div>
<div class="ttc" id="asdmap_8h_html_ab9b3b434ef67ee002598f23a70ade531"><div class="ttname"><a href="sdmap_8h.html#ab9b3b434ef67ee002598f23a70ade531">sdmap_erase</a></div><div class="ttdeci">#define sdmap_erase(map, key_expr)</div><div class="ttdoc">Erase a key from the map. If the key doesn't exist, then nothing is done.</div><div class="ttdef"><b>Definition:</b> sdmap.h:398</div></div>
</div><!-- fragment --><p> Output of the code: </p><div class="fragment"><div class="line">4</div>
</div><!-- fragment --> <h2><a class="anchor" id="sdmap_getsetp"></a>
Getting/Setting pointers</h2>
<p>The SDMAP library also provides a getter familiy of functions.<br  />
These allow the user, for example, to get the median average of a map with <a class="el" href="sdmap_8h.html#a2ee79904f24eff7f229af6e0ba6fee82">sdmap_root</a>. Or allow the user to traverse a map with <a class="el" href="sdmap_8h.html#a574eb76811a4e7a9812a9955b58f5fb8">sdmap_next</a> : </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a = NULL;</div>
<div class="line"><span class="comment">//Initialize...</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> *key = <a class="code hl_define" href="sdmap_8h.html#a6d92a70c1b420aa797c293a8095410ce">sdmap_min</a>(a);</div>
<div class="line"><span class="keywordflow">while</span> (key)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;key: %d   value: %d\n&quot;</span>, *key, <a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, key));</div>
<div class="line">    key = <a class="code hl_define" href="sdmap_8h.html#a574eb76811a4e7a9812a9955b58f5fb8">sdmap_next</a>(key);</div>
<div class="line">}</div>
<div class="ttc" id="asdmap_8h_html_a574eb76811a4e7a9812a9955b58f5fb8"><div class="ttname"><a href="sdmap_8h.html#a574eb76811a4e7a9812a9955b58f5fb8">sdmap_next</a></div><div class="ttdeci">#define sdmap_next(map, key_expr)</div><div class="ttdoc">Retrieve a pointer to the key that comes after key.</div><div class="ttdef"><b>Definition:</b> sdmap.h:504</div></div>
<div class="ttc" id="asdmap_8h_html_a6d92a70c1b420aa797c293a8095410ce"><div class="ttname"><a href="sdmap_8h.html#a6d92a70c1b420aa797c293a8095410ce">sdmap_min</a></div><div class="ttdeci">#define sdmap_min(map)</div><div class="ttdoc">Retrieve a pointer to the smallest key.</div><div class="ttdef"><b>Definition:</b> sdmap.h:454</div></div>
</div><!-- fragment --><p> or even do it backwards </p><div class="fragment"><div class="line"><a class="code hl_define" href="sdmap_8h.html#a6824b46342ace03c477fc71c66271e31">sdmap</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) a = NULL;</div>
<div class="line"><span class="comment">//Initialize...</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> *key = <a class="code hl_define" href="sdmap_8h.html#ab9200165d705be1deec29e85c787a5b2">sdmap_max</a>(a);</div>
<div class="line"><span class="keywordflow">while</span> (key)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;key: %d   value: %d\n&quot;</span>, *key, <a class="code hl_define" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a>(a, key));</div>
<div class="line">    key = <a class="code hl_define" href="sdmap_8h.html#adc4dc757bbf950ce4ecb06d264fc60b0">sdmap_prev</a>(key);</div>
<div class="line">}</div>
<div class="ttc" id="asdmap_8h_html_ab9200165d705be1deec29e85c787a5b2"><div class="ttname"><a href="sdmap_8h.html#ab9200165d705be1deec29e85c787a5b2">sdmap_max</a></div><div class="ttdeci">#define sdmap_max(map)</div><div class="ttdoc">Retrieve a pointer to the largest key.</div><div class="ttdef"><b>Definition:</b> sdmap.h:469</div></div>
<div class="ttc" id="asdmap_8h_html_adc4dc757bbf950ce4ecb06d264fc60b0"><div class="ttname"><a href="sdmap_8h.html#adc4dc757bbf950ce4ecb06d264fc60b0">sdmap_prev</a></div><div class="ttdeci">#define sdmap_prev(map, key_expr)</div><div class="ttdoc">Retrieve a pointer to the key that comes before key.</div><div class="ttdef"><b>Definition:</b> sdmap.h:526</div></div>
</div><!-- fragment --><p> The <a class="el" href="sdmap_8h.html#abae88efd1bcf9c22198e7845ab6928d2">sdmap_get</a> call within the loop will not increase the complexity because of <a class="el" href="sdmap_page.html#sdmap_amortized">amortized complexity</a>. </p>
<h2><a class="anchor" id="sdmap_advanced"></a>
Advanced</h2>
<p>The capacity of a heap-type map can be altered at runtime using the <a class="el" href="sdmap_8h.html#a883ff248816a4f332d49587b7840a444">sdmap_reserve</a> and <a class="el" href="sdmap_8h.html#a27a7508b5465c4dbb1f41f4e50ecc3ed">sdmap_shrink</a> functions. These either increase or decrease the capacity of the map. <a class="el" href="sdmap_8h.html#a883ff248816a4f332d49587b7840a444">sdmap_reserve</a> especially can be useful when halfway through the program, the user learns the upper bound of the number of entries in their map.<br  />
<br  />
Maps can be traversed even more efficiently than previous examples with the <code>sdmap_traverse_...</code> families of functions.</p>
<h1><a class="anchor" id="sdmap_usermacros"></a>
User macros</h1>
<p>For custom memory management all 3 of the memory functions should be overwritten: <a class="el" href="sdmap_8h.html#abccb263f6ef93f0b81390a418d3f378e">sdmap_malloc</a>, <a class="el" href="sdmap_8h.html#ab022021ac52ab2e5aa72b84dfe2994e4">sdmap_realloc</a>, <a class="el" href="sdmap_8h.html#ab08e085dfdb64d3ee572c01a7b974e92">sdmap_free</a>. <br  />
<br  />
<a class="el" href="sdmap_8h.html#a027d5bbb69571849cbefb5625e0aee65">SDMAP_DEFAULT_CAPACITY</a> controls the default capcity of heap-type maps, where the capacity is not specified.<br  />
<br  />
<a class="el" href="sdmap_8h.html#ab9b3b434ef67ee002598f23a70ade531">sdmap_erase</a> will automatically shirnk the map when the capacity/count ratio of the map exceeds <a class="el" href="sdmap_8h.html#ac99abb33e73739188501f04327cd6b8e">SDMAP_SHRINK_DENOMINATOR</a> and <a class="el" href="sdmap_8h.html#a18bb960e83e03951b43c8091f2031dfa">SDMAP_ENABLE_AUTOSHRINK</a> is not disabled.<br  />
<br  />
Asserts can be overwritten with <a class="el" href="sdmap_8h.html#a013ed3da333fd5db262d063b26eb717d">sdmap_assert</a>. <br  />
<br  />
By default, indexes in the map will be 32 bit integers, this behavior can be changed by overwriting <a class="el" href="sdmap_8h.html#a3d4ca89b98884034d59f19eef7a85ca3">sdmap_index_t</a>. <br  />
<br  />
The library makes heavy use of <code>typeof</code>. If your compiler supports this but not under <code>__typeof__</code> then it can be overwritten with <a class="el" href="sdmap_8h.html#a9bfffa2bea0be7ffdf1677096718f72a">sdmap_typeof</a>. </p>
<h1><a class="anchor" id="sdmap_pitfalls"></a>
Pitfalls</h1>
<h2><a class="anchor" id="sdmap_stack_type_maps"></a>
Stack-type maps</h2>
<p>Stack-type maps should in general be used sparingly. Allowing maps with high capcities runs the risk of a stack overflow (especially in a multithreaded situation).<br  />
 </p>
<h2><a class="anchor" id="sdmap_pointer_invalid"></a>
Pointer invalidation</h2>
<p>Any function that changes the state of a map runs the risk of invalidating any pointers the user may have gotten from other functions. This works similarly to C++'s iterator invalidation.<br  />
The user can check the file reference to see whether a function's description mentions "Calling this function invalidates all pointers...".</p>
<h2><a class="anchor" id="sdmap_amortized"></a>
Amortizied complexity</h2>
<p>Functions may benefit from being passed pointers returned from other functions. Doing so will result in faster execution and failing to do so can make loops or lookups unnecessarily long.<br  />
The user can check the file reference to see whether a function's description mentions any alternate average time complexity under certain conditions. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
